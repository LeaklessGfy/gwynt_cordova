var fightPage={eventLoaded:!1,decks:[],cards:[],cardsFamily:1,cardsLeft:2,cardsChanged:[],init:function(e){if(SongCaller.play("fight.mp3"),fightPage.eventListener(),"test"==e){var a={login:"Test adv",lvl:12};fightPage.setupFight(a)}else ApiCaller.get("users/"+e,{},fightPage.setupFight,ApiCaller.onError)},eventListener:function(){fightPage.eventLoaded||($("body").on("click",".change-cards",function(){fightPage.changeCards($(this))}),fightPage.eventLoaded=!0),$("#fight-end").click(function(){SongCaller.reset()})},setupFight:function(e){fightPage.cardsLeft=2,fightPage.cardsChanged=[],cards=[],$("#player1 .name").text(e.login),$("#player2 .name").text(user.login),ApiCaller.get("decks/"+user.id,{},fightPage.getDeck,ApiCaller.onError)},getDeck:function(e){fightPage.deck=e,fightPage.cards=[{id:1,img:"N01.png"},{id:2,img:"N02.png"},{id:3,img:"N03.png"},{id:4,img:"N04.png"},{id:5,img:"N05.png"},{id:6,img:"N06.png"},{id:7,img:"N07.png"},{id:8,img:"N08.png"},{id:9,img:"N09.png"},{id:10,img:"N10.png"}],fightPage.chooseCards()},chooseCards:function(){var e=$("#choose-cards");HydratorCaller.hydrate(e,$("#main-content"),"fight/choose-cards.html",null,function(){function e(e){return e%2==0}for(var a="",i=0;10>i;i++){var n=e(i);n&&(a+='<div class="row">'),a+='<div class="col-50"><a href="#" class="change-cards" data-id="'+fightPage.cards[i].id+'"><img src="img/cards/'+fightPage.cardsFamily+"/"+fightPage.cards[i].img+'" alt="img" width="100%"></a></div>',n||(a+="</div>")}$("#choose-cards .content").append(a)},function(){fightPage.handleDisplay()})},submitCards:function(){fightPage.cardsChanged.length,$("#choose-cards").hide(),SongCaller.reset(),SongCaller.play("fight-interlude.mp3",SongCaller.loop)},changeCards:function(e){var a=e.data("id"),i=e.find("img"),n=fightPage.isAlreadyDisable(a);if(n!==!1)fightPage.removeCardsToChange(i,n);else{if(!(fightPage.cardsLeft>0))return void alert("no cards left");fightPage.addCardsToChange(i,a)}fightPage.handleDisplay()},isAlreadyDisable:function(e){for(var a=!1,i=0;2>i;i++)e==fightPage.cardsChanged[i]&&(a=i);return a},addCardsToChange:function(e,a){e.addClass("disable"),fightPage.cardsChanged.push(a),fightPage.cardsLeft--},removeCardsToChange:function(e,a){e.removeClass("disable"),fightPage.cardsChanged.splice(a,1),fightPage.cardsLeft++},handleDisplay:function(){$("#choose-cards span").text("("+fightPage.cardsLeft+"/2)"),$("#choose-cards p").addClass("color-green").removeClass("color-red"),0==fightPage.cardsLeft&&$("#choose-cards p").removeClass("color-green").addClass("color-red")}},playPage={init:function(){SongCaller.play("play.mp3",SongCaller.loop),playPage.eventListener(),playPage.getFights()},eventListener:function(){$("body").on("click",".page-fight",function(){SongCaller.reset(),app.fightPage($(this).data("id"))}),$("#play-end").click(function(){SongCaller.reset()})},getFights:function(){ApiCaller.get("users",{},playPage.onGetSuccess,ApiCaller.onError)},onGetSuccess:function(e){for(var a="",i=0;i<e.length;i++)a+='<li><a href="#" class="item-link item-content page-fight" data-id="'+e[i].id+'"><div class="item-media"><i class="icon icon-f7"></i></div><div class="item-inner"><div class="item-title">'+e[i].login+" (lvl. "+e[i].level+') </div><div class="item-after">Affronter</div></div></a></li>';$("#play .content ul").append(a)}},profilInfo,contactInfo,appender,profilPage={init:function(){profilPage.eventListener(),profilPage.refreshDomObject(),profilPage.showProfilInfo()},eventListener:function(){$("#profil .sub-menu li a").click(function(){profilPage.handleMenu($(this)),profilPage.handleContent($(this).data("id"))})},refreshDomObject:function(){profilInfo=$("#profil-info"),contactInfo=$("#contact-info"),appender=$("#profil .content")},handleMenu:function(e){$("#profil .sub-menu li a").removeClass("actif"),e.addClass("actif")},handleContent:function(e){"profil-info"==e?profilPage.showProfilInfo():profilPage.showContactInfo()},showProfilInfo:function(){profilPage.refreshDomObject(),HydratorCaller.hydrate(profilInfo,appender,"profil/profil-info.html",contactInfo,profilPage.onProfilSuccess)},showContactInfo:function(){profilPage.refreshDomObject(),HydratorCaller.hydrate(contactInfo,appender,"profil/contact-info.html",profilInfo,profilPage.onContactSuccess)},onProfilSuccess:function(){CameraApi.init(),$("#pseudo-c").text(user.login),$(".page-content").addClass("bg"+localStorage.getItem("bg")),LocalStorageApi.init()},onContactSuccess:function(){ContactApi.init()}};