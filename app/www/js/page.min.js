var fightPage={eventLoaded:!1,cards:[],cardsLeft:2,cardsChanged:[],init:function(e){if(SongCaller.play("fight.mp3"),fightPage.eventListener(),"test"==e){var a={login:"Test adv",lvl:12};fightPage.setupFight(a)}else ApiCaller.get("users/"+e,{},fightPage.setupFight,ApiCaller.onError)},eventListener:function(){fightPage.eventLoaded||($("body").on("click",".change-cards",function(){fightPage.changeCards($(this))}),fightPage.eventLoaded=!0),$("#fight-end").click(function(){SongCaller.resetLoop()})},setupFight:function(e){fightPage.cardsLeft=2,fightPage.cardsChanged=[],$("#player1 .name").text(e.login),fightPage.chooseCards()},chooseCards:function(){var e=$("#choose-cards");HydratorCaller.hydrate(e,$("#main-content"),"fight/choose-cards.html",null,function(){},function(){$("#choose-cards .content a img").each(function(e,a){$(this).removeClass("disable")}),fightPage.handleDisplay()})},submitCards:function(){fightPage.cardsChanged.length,$("#choose-cards").hide(),SongCaller.resetLoop(),SongCaller.play("fight-interlude.mp3",SongCaller.loop)},changeCards:function(e){var a=e.data("id"),t=e.find("img"),n=fightPage.isAlreadyDisable(a);if(n!==!1)fightPage.removeCardsToChange(t,n);else{if(!(fightPage.cardsLeft>0))return void alert("no cards left");fightPage.addCardsToChange(t,a)}fightPage.handleDisplay()},isAlreadyDisable:function(e){for(var a=fightPage.cardsChanged.length,t=!1,n=0;a>n;n++)e==fightPage.cardsChanged[n]&&(t=n);return t},addCardsToChange:function(e,a){e.addClass("disable"),fightPage.cardsChanged.push(a),fightPage.cardsLeft--},removeCardsToChange:function(e,a){e.removeClass("disable"),fightPage.cardsChanged.splice(a,1),fightPage.cardsLeft++},handleDisplay:function(){$("#choose-cards span").text("("+fightPage.cardsLeft+"/2)"),$("#choose-cards p").addClass("color-green").removeClass("color-red"),0==fightPage.cardsLeft&&$("#choose-cards p").removeClass("color-green").addClass("color-red")}},playPage={init:function(){SongCaller.play("play.mp3",SongCaller.loop),playPage.eventListener(),playPage.getFights()},eventListener:function(){$("body").on("click",".page-fight",function(){SongCaller.resetLoop(),app.fightPage($(this).data("id"))}),$("#play-end").click(function(){SongCaller.resetLoop()})},getFights:function(){ApiCaller.get("users",{},playPage.onGetSuccess,ApiCaller.onError)},onGetSuccess:function(e){for(var a="",t=0;t<e.length;t++)a+='<li><a href="#" class="item-link item-content page-fight" data-id="'+e[t].id+'"><div class="item-media"><i class="icon icon-f7"></i></div><div class="item-inner"><div class="item-title">'+e[t].login+" (lvl. "+e[t].level+') </div><div class="item-after">Affronter</div></div></a></li>';$("#play .content ul").append(a)}},profilInfo,contactInfo,appender,profilPage={init:function(){profilPage.eventListener(),profilPage.refreshDomObject(),profilPage.showProfilInfo()},eventListener:function(){$("#profil .sub-menu li a").click(function(){profilPage.handleMenu($(this)),profilPage.handleContent($(this).data("id"))})},refreshDomObject:function(){profilInfo=$("#profil-info"),contactInfo=$("#contact-info"),appender=$("#profil .content")},handleMenu:function(e){$("#profil .sub-menu li a").removeClass("actif"),e.addClass("actif")},handleContent:function(e){"profil-info"==e?profilPage.showProfilInfo():profilPage.showContactInfo()},showProfilInfo:function(){profilPage.refreshDomObject(),HydratorCaller.hydrate(profilInfo,appender,"profil/profil-info.html",contactInfo,profilPage.onProfilSuccess)},showContactInfo:function(){profilPage.refreshDomObject(),HydratorCaller.hydrate(contactInfo,appender,"profil/contact-info.html",profilInfo,profilPage.onContactSuccess)},onProfilSuccess:function(){CameraApi.init(),$("#pseudo-c").text(localStorage.getItem("login")),$(".page-content").addClass("bg"+localStorage.getItem("bg")),LocalStorageApi.init()},onContactSuccess:function(){ContactApi.init()}};